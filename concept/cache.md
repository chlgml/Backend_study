## cache (캐시)

CPU 내부나 외부에 있으며, 처리 속도가 빠른 CPU와 상대적으로 느린 메모리의 속도 차이를 보완하는 역할을 하며, 데이터나 값을 미리 복사해 놓는 임시 장소를 말한다.

CPU가 다음에 참조할 정보가 얼마나 들었는지에 따라 성능이 좌우된다.

- 캐시 적중(cache hit) : 참조하려는 정보가 있을때
- 캐시 실패(cache miss) : 참조하려는 정보가 없을 때

캐시를 효율적으로 사용하려면 많은 것들이 있지만, 지역성에 대해서 알아보자.

먼저 지역성이란, 참조하는 범위가 전체가 아닌 어느 한 공간에서 여러번 참조되는 것을 뜻한다.

1. 공간적 지역성 : 참조한 주소와 인접한 주소의 내용을 참조함 이렇게 하게 되면 필요한 데이터가 모여있을 때는 잘 가져올 수 있지만, 흩어져 있다면 캐시 실패 확률이 높아지며, 메모리에 여러번 접근하게 되어 효율성이 떨어진다.
2. 시간적 지역성 : 한번 참조한 주소를 다시 참조함. 한번 가져왔던 데이터를 또 쓸일이 있다는 의미로, 한번 캐시에 저장해놓고 여러번 사용하게 된다면 메모리 접근 횟수가 줄어들기 때문에 효율성이 높아진다.



**1차 캐시와 2차 캐시**

- 1차 캐시란, 영속성 컨택스트 내부에 엔티티를 보관하는 저장소를 말한다. 일반적으로 트랜잭션을 시작하고 종료할 때까지만 1차 캐시가 유효하다. (OSIV를 사용하더라도 그렇다.)

  특징 : 같은 엔티티가 있으면 객체 동일성을 보장한다.



- 2차 캐시란, 애플리캐이션 범위의 캐시로, 공유 캐시라고도한다. 1차 캐시와 다르게 애플리케이션이 종료할 때까지 캐시가 유지된다.

  특징 : 2차 캐시는 동시성을 극대화하기 위해 캐시 한 객체를 직접 반환하지 않고 복사본을 만들어서 반환한다. 복사본을 반환하게 되면 동시성이 극대화된다. 락을 걸수도 있지만, 락을 거는 비용보다 복사하는 비용이 더 저렴하다. 하지만, 복사본을 반환하기 때문에 동일성을 보장하지 않는다.

  2차 캐시를 잘만 활용하면 1차 캐시의 동시성 문제를 해결하고 애플리케이션의 조회 성능을 끌어올릴 수 있습니다.